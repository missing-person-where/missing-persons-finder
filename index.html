<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寻人启示 - Missing Persons Platform</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>寻人启示平台</h1>
                <p>让爱回家 - Helping families reunite</p>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html" class="active">首页</a></li>
                    <li><a href="list.html">寻人列表</a></li>
                    <li><a href="submit.html">发布寻人</a></li>
                    <li><a href="about.html">关于我们</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="hero">
                <h2>每一个生命都值得被寻找</h2>
                <p>我们是一个公益平台，致力于帮助失踪人员找到回家的路。</p>
                <div class="hero-actions">
                    <a href="list.html" class="btn btn-primary">查看寻人信息</a>
                    <a href="submit.html" class="btn btn-accent">发布寻人启事</a>
                </div>
            </div>

            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>最新发布 / Recent Cases</h3>
                    <a href="list.html" style="color: var(--primary-color); text-decoration: none;">查看全部 &rarr;</a>
                </div>
                
                <div class="grid" id="recent-cases-grid">
                    <div style="text-align: center; width: 100%; grid-column: 1 / -1;">
                        <p>加载中... / Loading...</p>
                    </div>
                    <!-- Cards will be dynamically inserted here -->
                </div>
            </section>

            <script type="module">
                import { supabase } from './js/supabase-client.js';

                async function loadRecentCases() {
                    const container = document.getElementById('recent-cases-grid');
                    try {
                        const { data: cases, error } = await supabase
                            .from('missing_persons')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(3);
                        
                        if (error) throw error;

                        if (!cases || cases.length === 0) {
                            container.innerHTML = '<div style="text-align: center; width: 100%; grid-column: 1 / -1;"><p>暂无发布信息 / No cases found.</p></div>';
                            return;
                        }

                        container.innerHTML = cases.map(person => `
                            <div class="card">
                                <img src="${person.photo_url || 'https://placehold.co/400x300?text=No+Image'}" alt="${person.name}" class="card-img">
                                <div class="card-body">
                                    <h4 class="card-title">${person.name}</h4>
                                    <p class="card-text"><strong>走失地点:</strong> ${person.missing_location}</p>
                                    <p class="card-text"><strong>走失时间:</strong> ${new Date(person.missing_date).toLocaleDateString()}</p>
                                    <div style="margin-top: 1rem;">
                                        <span class="tag">${person.gender === 'male' ? '男' : '女'}</span>
                                    </div>
                                    <a href="detail.html?id=${person.id}" class="btn btn-outline" style="display: block; text-align: center; margin-top: 1rem;">查看详情</a>
                                </div>
                            </div>
                        `).join('');

                    } catch (err) {
                        console.error('Error loading cases:', err);
                        container.innerHTML = '<div style="text-align: center; width: 100%; grid-column: 1 / -1; color: red;"><p>加载失败，请刷新重试。</p></div>';
                    }
                }

                loadRecentCases();
            </script>

            <section style="margin-top: 4rem; text-align: center; background: white; padding: 3rem; border-radius: var(--radius); box-shadow: var(--shadow-sm);">
                <h3>如何提供帮助？</h3>
                <div class="grid" style="margin-top: 2rem;">
                    <div>
                        <h4>1. 浏览信息</h4>
                        <p>关注最新的寻人信息，留意身边是否有相似人员。</p>
                    </div>
                    <div>
                        <h4>2. 转发扩散</h4>
                        <p>将信息分享到社交媒体，让更多人看到。</p>
                    </div>
                    <div>
                        <h4>3. 提供线索</h4>
                        <p>如果有任何线索，请立即联系家属或平台。</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 寻人启示公益平台 Missing Persons Finder</p>
            <p>联系我们: contact@missingpersons.org | 电话: 400-123-4567</p>
        </div>
    </footer>
</body>
</html>
